!function(e){function t(e,t){var n=new google.maps.Map(e,t),o=new google.maps.Marker({position:new google.maps.LatLng(54.19335,-3.92695),map:n,title:"Drag Me",visible:t.markerVisible,draggable:t.markerDraggable,icon:void 0!==t.markerIcon?t.markerIcon:void 0});return{map:n,marker:o,circle:null,location:o.position,radius:t.radius,locationName:t.locationName,addressComponents:{formatted_address:null,addressLine1:null,addressLine2:null,streetName:null,streetNumber:null,city:null,district:null,state:null,stateOrProvince:null},settings:t.settings,domContainer:e,geodecoder:new google.maps.Geocoder}}function n(e){return void 0!=o(e)}function o(t){return e(t).data("locationpicker")}function a(e,t){if(e){var n=l.locationFromLatLng(t.marker.position);e.latitudeInput&&e.latitudeInput.val(n.latitude).change(),e.longitudeInput&&e.longitudeInput.val(n.longitude).change(),e.radiusInput&&e.radiusInput.val(t.radius).change(),e.locationNameInput&&e.locationNameInput.val(t.locationName).change(),e.locationPlaceIdInput&&e.locationPlaceIdInput.val(t.place_id).change(),e.schemaStreetAddress&&e.schemaStreetAddress.val(t.addressComponents.addressLine1).change(),e.schemaAddressLocality&&e.schemaAddressLocality.val(t.addressComponents.city).change(),e.schemaAddressRegion&&("GB"===t.addressComponents.country?e.schemaAddressRegion.val(t.addressComponents.county).change():e.schemaAddressRegion.val(t.addressComponents.stateOrProvince).change()),e.schemaPostalCode&&e.schemaPostalCode.val(t.addressComponents.postalCode).change(),e.schemaAddressCountry&&e.schemaAddressCountry.val(t.addressComponents.country).change()}}function i(t,n){if(t){if(t.radiusInput&&t.radiusInput.on("change",function(t){var o=e(this).val();t.originalEvent&&!isNaN(o)&&(n.radius=o,l.setPosition(n,n.location,function(e){e.settings.onchanged.apply(n.domContainer,[l.locationFromLatLng(e.location),e.radius,!1])}))}),t.locationNameInput&&n.settings.enableAutocomplete){var o=!1;n.autocomplete=new google.maps.places.Autocomplete(t.locationNameInput.get(0),n.settings.autocompleteOptions),google.maps.event.addListener(n.autocomplete,"place_changed",function(){o=!1;var e=n.autocomplete.getPlace();return e.geometry?void l.setPosition(n,e.geometry.location,function(e){a(t,e),e.settings.onchanged.apply(n.domContainer,[l.locationFromLatLng(e.location),e.radius,!1])}):void n.settings.onlocationnotfound(e.name)}),n.settings.enableAutocompleteBlur&&(t.locationNameInput.on("change",function(e){e.originalEvent&&(o=!0)}),t.locationNameInput.on("blur",function(i){i.originalEvent&&setTimeout(function(){var i=e(t.locationNameInput).val();i.length>5&&o&&(o=!1,n.geodecoder.geocode({address:i},function(e,o){o==google.maps.GeocoderStatus.OK&&e&&e.length&&l.setPosition(n,e[0].geometry.location,function(e){a(t,e),e.settings.onchanged.apply(n.domContainer,[l.locationFromLatLng(e.location),e.radius,!1])})}))},1e3)}))}t.latitudeInput&&t.latitudeInput.on("change",function(t){var o=e(this).val();t.originalEvent&&!isNaN(o)&&l.setPosition(n,new google.maps.LatLng(o,n.location.lng()),function(e){e.settings.onchanged.apply(n.domContainer,[l.locationFromLatLng(e.location),e.radius,!1]),a(n.settings.inputBinding,n)})}),t.longitudeInput&&t.longitudeInput.on("change",function(t){var o=e(this).val();t.originalEvent&&!isNaN(o)&&l.setPosition(n,new google.maps.LatLng(n.location.lat(),o),function(e){e.settings.onchanged.apply(n.domContainer,[l.locationFromLatLng(e.location),e.radius,!1]),a(n.settings.inputBinding,n)})})}}function s(e){google.maps.event.trigger(e.map,"resize"),setTimeout(function(){e.map.setCenter(e.marker.position)},300)}function r(t,n,o){var a=e.extend({},e.fn.locationpicker.defaults,o),s=a.location.latitude,r=a.location.longitude,d=a.radius,c=t.settings.location.latitude,u=t.settings.location.longitude,g=t.settings.radius;(s!=c||r!=u||d!=g)&&(t.settings.location.latitude=s,t.settings.location.longitude=r,t.radius=d,l.setPosition(t,new google.maps.LatLng(t.settings.location.latitude,t.settings.location.longitude),function(e){i(t.settings.inputBinding,t),e.settings.oninitialized(n)}))}var l={drawCircle:function(t,n,o,a){return null!=t.circle&&t.circle.setMap(null),o>0?(o*=1,a=e.extend({strokeColor:"#0000FF",strokeOpacity:.35,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.2},a),a.map=t.map,a.radius=o,a.center=n,t.circle=new google.maps.Circle(a),t.circle):null},setPosition:function(e,t,n){e.location=t,e.marker.setPosition(t),e.map.panTo(t),this.drawCircle(e,t,e.radius,{}),e.settings.enableReverseGeocode?this.updateLocationName(e,n):n&&n.call(this,e)},locationFromLatLng:function(e){return{latitude:e.lat(),longitude:e.lng()}},addressByFormat:function(e,t){for(var n=null,o=e.length-1;o>=0;o--)e[o].types.indexOf(t)>=0&&(n=e[o]);return n||e[0]},updateLocationName:function(e,t){e.geodecoder.geocode({latLng:e.marker.position},function(n,o){if(o==google.maps.GeocoderStatus.OK&&n.length>0){var a=l.addressByFormat(n,e.settings.addressFormat);e.locationName=a.formatted_address,e.addressComponents=l.address_component_from_google_geocode(a.address_components),e.place_id=a.place_id}else if(o==google.maps.GeocoderStatus.OVER_QUERY_LIMIT)return setTimeout(function(){l.updateLocationName(e,t)},1e3);t&&t.call(this,e)})},address_component_from_google_geocode:function(e){console.log(e);for(var t={},n=e.length-1;n>=0;n--){var o=e[n];o.types.indexOf("postal_code")>=0?t.postalCode=o.short_name:o.types.indexOf("street_number")>=0?t.streetNumber=o.short_name:o.types.indexOf("route")>=0?t.streetName=o.short_name:o.types.indexOf("locality")>=0?t.city=o.short_name:""===t.city&&o.types.indexOf("postal_town")>=0?t.city=o.short_name:""===t.city&&o.types.indexOf("sublocality")>=0?t.city=o.short_name:o.types.indexOf("administrative_area_level_2")>=0?t.county=o.short_name:o.types.indexOf("administrative_area_level_1")>=0?t.stateOrProvince=o.short_name:o.types.indexOf("country")>=0&&(t.country=o.short_name)}return t.addressLine1=[t.streetNumber,t.streetName].join(" ").trim(),t.addressLine2="",t}};e.fn.locationpicker=function(d,c){if("string"==typeof d){var u=this.get(0);if(!n(u))return;var g=o(u);switch(d){case"location":if(void 0==c){var m=l.locationFromLatLng(g.location);return m.radius=g.radius,m.name=g.locationName,m}c.radius&&(g.radius=c.radius),l.setPosition(g,new google.maps.LatLng(c.latitude,c.longitude),function(e){a(e.settings.inputBinding,e)});break;case"subscribe":if(void 0==c)return null;var p=c.event,f=c.callback;if(!p||!f)return console.error('LocationPicker: Invalid arguments for method "subscribe"'),null;google.maps.event.addListener(g.map,p,f);break;case"map":if(void 0==c){var h=l.locationFromLatLng(g.location);return h.formattedAddress=g.locationName,h.addressComponents=g.addressComponents,{map:g.map,marker:g.marker,location:h}}return null;case"autosize":return s(g),this}return null}return this.each(function(){function s(){l.setPosition(g,g.marker.position,function(e){var t=l.locationFromLatLng(g.location);a(g.settings.inputBinding,g),e.settings.onchanged.apply(g.domContainer,[t,e.radius,!0])})}var c=e(this);if(n(this))return void r(o(this),e(this),d);var u=e.extend({},e.fn.locationpicker.defaults,d),g=new t(this,e.extend({},{zoom:u.zoom,center:new google.maps.LatLng(u.location.latitude,u.location.longitude),mapTypeId:u.mapTypeId,mapTypeControl:!1,styles:u.styles,disableDoubleClickZoom:!1,scrollwheel:u.scrollwheel,streetViewControl:!1,radius:u.radius,locationName:u.locationName,settings:u,autocompleteOptions:u.autocompleteOptions,addressFormat:u.addressFormat,draggable:u.draggable,markerIcon:u.markerIcon,markerDraggable:u.markerDraggable,markerVisible:u.markerVisible},u.mapOptions));c.data("locationpicker",g),u.markerInCenter&&(g.map.addListener("bounds_changed",function(){g.marker.dragging||(g.marker.setPosition(g.map.center),a(g.settings.inputBinding,g))}),g.map.addListener("idle",function(){g.marker.dragging||s()})),google.maps.event.addListener(g.marker,"drag",function(e){a(g.settings.inputBinding,g)}),google.maps.event.addListener(g.marker,"dragend",function(e){s()}),l.setPosition(g,new google.maps.LatLng(u.location.latitude,u.location.longitude),function(e){a(u.inputBinding,g),i(u.inputBinding,g),e.settings.oninitialized(c)})})},e.fn.locationpicker.defaults={location:{latitude:40.7324319,longitude:-73.82480777777776},locationName:"",radius:500,zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[],mapOptions:{},scrollwheel:!0,inputBinding:{latitudeInput:null,longitudeInput:null,radiusInput:null,locationNameInput:null,schemaStreetAddress:null,schemaAddressLocality:null,schemaAddressRegion:null,schemaPostalCode:null,schemaAddressCountry:null},enableAutocomplete:!1,enableAutocompleteBlur:!1,autocompleteOptions:null,addressFormat:"postal_code",enableReverseGeocode:!0,draggable:!0,onchanged:function(e,t,n){},onlocationnotfound:function(e){},oninitialized:function(e){},markerIcon:void 0,markerDraggable:!0,markerVisible:!0}}(jQuery);
